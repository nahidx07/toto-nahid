<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toto Live - Premium Streaming</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #0a0a0f;
            --card: #1a1a2e;
            --red: #ff3860;
            --blue: #3273dc;
            --yellow: #ffdd57;
            --text: #ffffff;
            --text2: #b0b0c0;
            --border: #2a2a3a;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Hind Siliguri', sans-serif; 
            background: var(--bg); 
            color: var(--text);
            padding-bottom: 90px; /* Extra space for bottom nav */
        }
        
        /* Header */
        .header { 
            background: var(--card); 
            padding: 15px 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .logo-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .custom-logo {
            height: 35px;
            width: auto;
            max-width: 150px;
            object-fit: contain;
        }
        .logo-text { 
            font-size: 24px; 
            font-weight: bold; 
            background: linear-gradient(45deg, var(--red), var(--yellow));
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            display: none; /* Hidden by default, shown if no logo */
        }
        .xp-badge { 
            background: rgba(255,221,87,0.2); 
            padding: 8px 15px; 
            border-radius: 20px; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            font-size: 14px;
        }
        
        /* Main Content */
        .main { 
            padding: 20px; 
            max-width: 1200px; 
            margin: 0 auto; 
            min-height: calc(100vh - 150px);
        }
        .page-title { 
            margin-bottom: 20px; 
            display: flex; 
            align-items: center; 
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        /* Matches Grid */
        .matches-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .match-card { 
            background: var(--card); 
            border-radius: 15px; 
            overflow: hidden; 
            border: 1px solid var(--border);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        .match-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        .match-thumb { 
            width: 100%; 
            height: 180px; 
            background: #000; 
            position: relative; 
        }
        .live-badge { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            background: var(--red); 
            color: white; 
            padding: 5px 15px; 
            border-radius: 15px; 
            font-size: 12px; 
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .match-info { padding: 15px; }
        .match-title { 
            font-size: 18px; 
            margin-bottom: 10px;
            line-height: 1.4;
            height: 50px;
            overflow: hidden;
        }
        .match-meta { 
            display: flex; 
            justify-content: space-between; 
            color: var(--text2); 
            font-size: 14px;
            align-items: center;
        }
        
        /* Video Player Modal */
        .video-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .video-container {
            width: 95%;
            max-width: 900px;
            background: var(--card);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        .video-header {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }
        .video-player {
            width: 100%;
            height: 500px;
        }
        @media (max-width: 768px) {
            .video-player {
                height: 300px;
            }
        }
        .close-video {
            background: var(--red);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
        }
        
        /* Stats */
        .stats { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin: 30px 0; 
        }
        .stat-card { 
            background: var(--card); 
            padding: 20px; 
            border-radius: 15px; 
            border: 1px solid var(--border);
            display: flex; 
            align-items: center; 
            gap: 15px; 
            transition: transform 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-3px);
        }
        .stat-icon { 
            width: 50px; 
            height: 50px; 
            background: rgba(50,115,220,0.1); 
            border-radius: 12px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 24px; 
            color: var(--blue); 
        }
        
        /* Profile Page */
        .profile-page, .leaderboard-page {
            display: none;
        }
        .profile-card {
            background: var(--card);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }
        .profile-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, var(--red), var(--blue));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }
        .profile-details {
            flex: 1;
        }
        .profile-name {
            font-size: 24px;
            margin-bottom: 5px;
        }
        .profile-badge {
            background: rgba(255,221,87,0.2);
            color: var(--yellow);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .stats-grid-profile {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .stat-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--yellow);
        }
        
        /* Leaderboard */
        .leaderboard-card {
            background: var(--card);
            border-radius: 15px;
            border: 1px solid var(--border);
            overflow: hidden;
        }
        .leaderboard-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .leaderboard-list {
            max-height: 500px;
            overflow-y: auto;
        }
        .leaderboard-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .leaderboard-item:nth-child(1) .rank {
            background: var(--yellow);
            color: #000;
        }
        .leaderboard-item:nth-child(2) .rank {
            background: #c0c0c0;
            color: #000;
        }
        .leaderboard-item:nth-child(3) .rank {
            background: #cd7f32;
            color: #000;
        }
        .rank {
            width: 40px;
            height: 40px;
            background: var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .user-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(45deg, var(--red), var(--blue));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .user-info {
            flex: 1;
        }
        .user-name {
            font-weight: bold;
        }
        .user-xp {
            color: var(--yellow);
            font-weight: bold;
            font-size: 18px;
        }
        
        /* Navigation */
        .nav { 
            position: fixed; 
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card); 
            padding: 15px 0;
            display: flex; 
            justify-content: space-around;
            border-top: 1px solid var(--border);
            z-index: 99;
        }
        .nav-btn { 
            background: none; 
            border: none; 
            color: var(--text2); 
            font-size: 20px; 
            cursor: pointer; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 5px; 
            transition: color 0.3s;
            padding: 5px 15px;
            border-radius: 10px;
            flex: 1;
            max-width: 100px;
        }
        .nav-btn:hover { 
            color: var(--text); 
            background: rgba(255,255,255,0.05);
        }
        .nav-btn.active { 
            color: var(--red); 
        }
        .nav-btn span { 
            font-size: 12px; 
            font-weight: 500;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text2);
        }
        .loading-spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--red);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .matches-grid { 
                grid-template-columns: 1fr; 
            }
            .stats {
                grid-template-columns: 1fr;
            }
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            .video-player {
                height: 250px;
            }
            .custom-logo {
                height: 30px;
            }
        }
        @media (max-width: 480px) {
            .header {
                padding: 12px 15px;
            }
            .main {
                padding: 15px;
            }
            .nav-btn {
                font-size: 18px;
                padding: 5px 10px;
            }
            .nav-btn span {
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo-container">
            <img id="site-logo" class="custom-logo" alt="Toto Live">
            <div id="site-logo-text" class="logo-text">TOTO LIVE</div>
        </div>
        <div class="xp-badge">
            <i class="fas fa-bolt"></i>
            <span id="xp">0</span> XP
        </div>
    </header>

    <!-- Video Modal -->
    <div class="video-modal" id="video-modal">
        <div class="video-container">
            <div class="video-header">
                <h3 id="video-title">Live Stream</h3>
                <button class="close-video" onclick="closeVideo()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="video-player"></div>
        </div>
    </div>

    <!-- Home Page -->
    <main class="main" id="home-page">
        <h2 class="page-title"><i class="fas fa-tv"></i> লাইভ ম্যাচ</h2>
        
        <!-- Loading -->
        <div id="matches-loading" class="loading">
            <div class="loading-spinner"></div>
            <p>ম্যাচ লোড হচ্ছে...</p>
        </div>
        
        <!-- Matches -->
        <div class="matches-grid" id="matches">
            <!-- Matches will load here -->
        </div>
        
        <!-- Stats -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-users"></i></div>
                <div>
                    <h3 id="total-users">0</h3>
                    <p>মোট ইউজার</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-eye"></i></div>
                <div>
                    <h3 id="watching">0</h3>
                    <p>দর্শক</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-trophy"></i></div>
                <div>
                    <h3 id="live-matches">0</h3>
                    <p>লাইভ ম্যাচ</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-bolt"></i></div>
                <div>
                    <h3 id="your-rank">-</h3>
                    <p>আপনার র‍্যাংক</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Profile Page -->
    <div class="main profile-page" id="profile-page">
        <h2 class="page-title"><i class="fas fa-user"></i> প্রোফাইল</h2>
        
        <div class="profile-card">
            <div class="profile-header">
                <div class="profile-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="profile-details">
                    <h2 class="profile-name" id="profile-name">নতুন ব্যবহারকারী</h2>
                    <div class="profile-badge">
                        <i class="fas fa-bolt"></i>
                        <span id="profile-xp">0</span> XP
                    </div>
                </div>
            </div>
            
            <div class="stats-grid-profile">
                <div class="stat-item">
                    <div class="stat-value" id="profile-watched">0</div>
                    <div>দেখা ম্যাচ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="profile-rank">-</div>
                    <div>র‍্যাংক</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="profile-joined">0</div>
                    <div>দিন</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="profile-status">ফ্রি</div>
                    <div>স্ট্যাটাস</div>
                </div>
            </div>
        </div>
        
        <h3 class="page-title"><i class="fas fa-history"></i> সাম্প্রতিক কার্যক্রম</h3>
        <div class="profile-card">
            <div id="recent-activity">
                <p style="text-align: center; color: var(--text2); padding: 20px;">
                    এখনও কোন কার্যক্রম নেই
                </p>
            </div>
        </div>
    </div>

    <!-- Leaderboard Page -->
    <div class="main leaderboard-page" id="leaderboard-page">
        <h2 class="page-title"><i class="fas fa-trophy"></i> লিডারবোর্ড</h2>
        
        <div class="leaderboard-card">
            <div class="leaderboard-header">
                <h3>শীর্ষ ২০ ব্যবহারকারী</h3>
                <div class="profile-badge">
                    <i class="fas fa-crown"></i>
                    <span id="your-leaderboard-rank">র‍্যাংক: -</span>
                </div>
            </div>
            
            <div class="leaderboard-list" id="leaderboard-list">
                <div class="loading" style="padding: 30px;">
                    <div class="loading-spinner"></div>
                    <p>লিডারবোর্ড লোড হচ্ছে...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="nav">
        <button class="nav-btn active" onclick="showPage('home-page', this)">
            <i class="fas fa-home"></i>
            <span>হোম</span>
        </button>
        <button class="nav-btn" onclick="showPage('profile-page', this)">
            <i class="fas fa-user"></i>
            <span>প্রোফাইল</span>
        </button>
        <button class="nav-btn" onclick="showPage('leaderboard-page', this)">
            <i class="fas fa-trophy"></i>
            <span>লিডারবোর্ড</span>
        </button>
    </nav>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <!-- App Script -->
    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyAmdXx4PAETjr42lpSbTR6sb5H0WqUyzoo",
            authDomain: "totolive-6689f.firebaseapp.com",
            databaseURL: "https://totolive-6689f-default-rtdb.firebaseio.com",
            projectId: "totolive-6689f",
            storageBucket: "",
            messagingSenderId: "423841122771",
            appId: "1:423841122771:web:ad3c529d8dc9833a69c726"
        };
        
        // Initialize
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        
        // User ID
        let userId = localStorage.getItem('user_id');
        if (!userId) {
            userId = 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
            localStorage.setItem('user_id', userId);
        }
        
        let currentMatches = [];
        let leaderboardData = [];
        let userData = {};
        
        // Page Navigation
        function showPage(pageId, button) {
            // Hide all pages
            document.getElementById('home-page').style.display = 'none';
            document.getElementById('profile-page').style.display = 'none';
            document.getElementById('leaderboard-page').style.display = 'none';
            
            // Show selected page
            document.getElementById(pageId).style.display = 'block';
            
            // Update active nav button
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (button) {
                button.classList.add('active');
            }
            
            // Load data for page
            if (pageId === 'home-page') {
                loadHomePage();
            } else if (pageId === 'profile-page') {
                loadProfilePage();
            } else if (pageId === 'leaderboard-page') {
                loadLeaderboardPage();
            }
        }
        
        // Load Logo
        function loadLogo() {
            db.ref('settings/logoUrl').on('value', snapshot => {
                const logoUrl = snapshot.val();
                const logoImg = document.getElementById('site-logo');
                const logoText = document.getElementById('site-logo-text');
                
                if (logoUrl && logoUrl.trim() !== '') {
                    logoImg.src = logoUrl;
                    logoImg.style.display = 'block';
                    logoText.style.display = 'none';
                } else {
                    logoImg.style.display = 'none';
                    logoText.style.display = 'block';
                }
            });
        }
        
        // Load Home Page
        function loadHomePage() {
            loadMatches();
            loadUsersCount();
        }
        
        // Load Matches
        function loadMatches() {
            document.getElementById('matches-loading').style.display = 'block';
            
            db.ref('matches').on('value', snapshot => {
                document.getElementById('matches-loading').style.display = 'none';
                const container = document.getElementById('matches');
                container.innerHTML = '';
                
                currentMatches = [];
                let totalWatching = 0;
                let liveMatchCount = 0;
                
                snapshot.forEach(child => {
                    const match = child.val();
                    const matchId = child.key;
                    
                    if (match.status === 'active') {
                        currentMatches.push({ id: matchId, ...match });
                        
                        totalWatching += match.watching || 0;
                        liveMatchCount++;
                        
                        const card = document.createElement('div');
                        card.className = 'match-card';
                        card.setAttribute('data-match-id', matchId);
                        
                        card.innerHTML = `
                            <div class="match-thumb">
                                <div class="live-badge">● LIVE</div>
                            </div>
                            <div class="match-info">
                                <h3 class="match-title">${match.title || 'Live Match'}</h3>
                                <div class="match-meta">
                                    <span><i class="fas fa-futbol"></i> ${match.category || 'Sports'}</span>
                                    <span><i class="fas fa-eye"></i> ${match.watching || 0}</span>
                                </div>
                            </div>
                        `;
                        
                        // Set background image if thumbnail exists
                        if (match.thumbnail) {
                            card.querySelector('.match-thumb').style.backgroundImage = `url('${match.thumbnail}')`;
                            card.querySelector('.match-thumb').style.backgroundSize = 'cover';
                            card.querySelector('.match-thumb').style.backgroundPosition = 'center';
                        }
                        
                        // Add click event
                        card.onclick = () => openMatch(matchId);
                        container.appendChild(card);
                    }
                });
                
                // Update stats
                document.getElementById('watching').textContent = totalWatching;
                document.getElementById('live-matches').textContent = liveMatchCount;
                
                // Update user rank
                updateUserRank();
            });
        }
        
        // Open Match
        function openMatch(matchId) {
            const match = currentMatches.find(m => m.id === matchId);
            if (!match) return;
            
            const modal = document.getElementById('video-modal');
            const videoContainer = document.getElementById('video-player');
            const videoTitle = document.getElementById('video-title');
            
            videoTitle.textContent = match.title || 'Live Stream';
            
            // Clear previous video
            videoContainer.innerHTML = '';
            
            // Check if videoUrl is embed code or URL
            if (match.videoUrl && match.videoUrl.includes('<iframe')) {
                // It's embed code
                videoContainer.innerHTML = match.videoUrl;
            } else if (match.videoUrl) {
                // It's a URL - create iframe
                let embedUrl = match.videoUrl;
                
                // Convert YouTube URL to embed URL
                if (match.videoUrl.includes('youtube.com/watch')) {
                    const videoId = match.videoUrl.split('v=')[1];
                    embedUrl = `https://www.youtube.com/embed/${videoId}`;
                } else if (match.videoUrl.includes('youtu.be/')) {
                    const videoId = match.videoUrl.split('youtu.be/')[1];
                    embedUrl = `https://www.youtube.com/embed/${videoId}`;
                }
                
                const iframe = document.createElement('iframe');
                iframe.src = embedUrl;
                iframe.className = 'video-player';
                iframe.frameBorder = '0';
                iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                iframe.allowFullscreen = true;
                videoContainer.appendChild(iframe);
            } else {
                videoContainer.innerHTML = `
                    <div style="padding: 40px; text-align: center; color: var(--text2);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <h3>ভিডিও লোড করতে সমস্যা হচ্ছে</h3>
                        <p>দয়া করে পরে আবার চেষ্টা করুন</p>
                    </div>
                `;
            }
            
            // Show modal
            modal.style.display = 'flex';
            
            // Increment watching count
            db.ref('matches/' + matchId + '/watching').transaction(current => {
                return (current || 0) + 1;
            });
            
            // Record user activity
            recordUserActivity('watched_match', match.title);
        }
        
        // Close Video
        function closeVideo() {
            document.getElementById('video-modal').style.display = 'none';
        }
        
        // Load Users Count
        function loadUsersCount() {
            db.ref('users').on('value', snapshot => {
                const count = snapshot.numChildren();
                document.getElementById('total-users').textContent = count;
            });
        }
        
        // Initialize User
        function initUser() {
            const userRef = db.ref('users/' + userId);
            
            userRef.once('value').then(snap => {
                if (!snap.exists()) {
                    // Get default XP from settings
                    db.ref('settings/defaultXp').once('value').then(settingsSnap => {
                        const defaultXp = settingsSnap.val() || 1000;
                        
                        userRef.set({
                            name: 'নতুন ব্যবহারকারী',
                            xp: defaultXp,
                            createdAt: Date.now(),
                            lastSeen: Date.now(),
                            watchedMatches: 0,
                            joinDate: new Date().toLocaleDateString('bn-BD')
                        });
                    });
                } else {
                    userRef.update({ lastSeen: Date.now() });
                    userData = snap.val();
                }
            });
            
            // Listen for user updates
            userRef.on('value', snap => {
                const user = snap.val();
                if (user) {
                    userData = user;
                    document.getElementById('xp').textContent = user.xp || 0;
                    updateUserRank();
                }
            });
        }
        
        // Update User Rank
        function updateUserRank() {
            if (leaderboardData.length === 0) return;
            
            const userIndex = leaderboardData.findIndex(user => user.id === userId);
            if (userIndex !== -1) {
                document.getElementById('your-rank').textContent = `#${userIndex + 1}`;
            }
        }
        
        // Record User Activity
        function recordUserActivity(type, details) {
            const activityRef = db.ref(`users/${userId}/activities`).push();
            activityRef.set({
                type: type,
                details: details,
                timestamp: Date.now(),
                date: new Date().toLocaleString('bn-BD')
            });
            
            // Update watched matches count
            if (type === 'watched_match') {
                db.ref(`users/${userId}/watchedMatches`).transaction(current => {
                    return (current || 0) + 1;
                });
                
                // Add XP for watching
                db.ref(`users/${userId}/xp`).transaction(current => {
                    return (current || 0) + 10;
                });
            }
        }
        
        // Load Profile Page
        function loadProfilePage() {
            if (userData) {
                document.getElementById('profile-name').textContent = userData.name || 'নতুন ব্যবহারকারী';
                document.getElementById('profile-xp').textContent = userData.xp || 0;
                document.getElementById('profile-watched').textContent = userData.watchedMatches || 0;
                
                // Calculate days joined
                if (userData.createdAt) {
                    const joinDate = new Date(userData.createdAt);
                    const today = new Date();
                    const days = Math.floor((today - joinDate) / (1000 * 60 * 60 * 24));
                    document.getElementById('profile-joined').textContent = days;
                }
                
                // Update rank
                if (leaderboardData.length > 0) {
                    const userIndex = leaderboardData.findIndex(user => user.id === userId);
                    if (userIndex !== -1) {
                        document.getElementById('profile-rank').textContent = `#${userIndex + 1}`;
                    }
                }
                
                // Load recent activity
                loadRecentActivity();
            }
        }
        
        // Load Recent Activity
        function loadRecentActivity() {
            const activityContainer = document.getElementById('recent-activity');
            
            db.ref(`users/${userId}/activities`).limitToLast(5).once('value').then(snapshot => {
                if (!snapshot.exists() || snapshot.numChildren() === 0) {
                    activityContainer.innerHTML = `
                        <p style="text-align: center; color: var(--text2); padding: 20px;">
                            এখনও কোন কার্যক্রম নেই
                        </p>
                    `;
                    return;
                }
                
                let activitiesHtml = '';
                snapshot.forEach(child => {
                    const activity = child.val();
                    let icon = 'fas fa-check';
                    let text = activity.details || 'কার্যক্রম';
                    
                    if (activity.type === 'watched_match') {
                        icon = 'fas fa-eye';
                        text = `দেখেছেন: ${activity.details}`;
                    }
                    
                    activitiesHtml += `
                        <div style="padding: 10px 0; border-bottom: 1px solid var(--border);">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <i class="${icon}" style="color: var(--blue);"></i>
                                <div style="flex: 1;">
                                    <div>${text}</div>
                                    <small style="color: var(--text2);">${activity.date || ''}</small>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                activityContainer.innerHTML = activitiesHtml;
            });
        }
        
        // Load Leaderboard Page
        function loadLeaderboardPage() {
            const leaderboardList = document.getElementById('leaderboard-list');
            
            db.ref('users').once('value').then(snapshot => {
                leaderboardData = [];
                
                snapshot.forEach(child => {
                    const user = child.val();
                    leaderboardData.push({
                        id: child.key,
                        name: user.name || 'নতুন ব্যবহারকারী',
                        xp: user.xp || 0,
                        premium: user.premium || false
                    });
                });
                
                // Sort by XP
                leaderboardData.sort((a, b) => b.xp - a.xp);
                
                // Display leaderboard
                let leaderboardHtml = '';
                leaderboardData.slice(0, 20).forEach((user, index) => {
                    leaderboardHtml += `
                        <div class="leaderboard-item">
                            <div class="rank">${index + 1}</div>
                            <div class="user-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="user-info">
                                <div class="user-name">${user.name}</div>
                                <div>${user.premium ? '<i class="fas fa-crown" style="color: var(--yellow);"></i> প্রিমিয়াম' : 'ফ্রি'}</div>
                            </div>
                            <div class="user-xp">${user.xp} XP</div>
                        </div>
                    `;
                });
                
                leaderboardList.innerHTML = leaderboardHtml;
                
                // Update user's rank
                const userIndex = leaderboardData.findIndex(user => user.id === userId);
                if (userIndex !== -1) {
                    document.getElementById('your-leaderboard-rank').textContent = `র‍্যাংক: #${userIndex + 1}`;
                }
            });
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initUser();
            loadLogo();
            loadHomePage();
            loadLeaderboardPage();
            
            // Close video when clicking outside
            document.getElementById('video-modal').onclick = function(e) {
                if (e.target === this) {
                    closeVideo();
                }
            };
        });
        
        // Auto-refresh every 30 seconds
        setInterval(() => {
            loadMatches();
        }, 30000);
    </script>
</body>
</html>
